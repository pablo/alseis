<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap -->
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- al seis -->
    <link href="css/alseis.css" rel="stylesheet">
  </head>
  <body style="padding-right: 80px">

      <!-- ONE COLUMN FOR EACH SHEET -->
      <div class="table-responsive">
      <table id="scoresheets_table" class="table table-bordered">
        <thead>
          <tr class="score_play_header success">
            <th></th>
          </tr>
          <tr class="score_players_header success">
            <th></th>
          </tr>

        </thead>
        <tbody>
          <tr class="total_row warning">
            <td class="headers_col"><h2>Total</h2></td>
          </tr>
          <tr class="score_row digits" data-play="_4">
            <td class="headers_col"><img width="32" src="img/dice-04.png">&nbsp;</td>
          </tr>
          <tr class="score_row digits" data-play="_5">
            <td class="headers_col"><img width="32" src="img/dice-05.png"></td>
          </tr>
          <tr class="score_row digits" data-play="_6">
            <td class="headers_col"><img width="32" src="img/dice-06.png"></td>
          </tr>
          <tr class="score_row plays" data-play="_straight">
            <td class="headers_col">
              <img width="16" src="img/dice-06.png">
              <img width="16" src="img/dice-05.png">
              <img width="16" src="img/dice-04.png"><br>
              <img width="16" src="img/dice-03.png">
              <img width="16" src="img/dice-01.png">
            </td>
          </tr>
          <tr class="score_row plays" data-play="_fullhouse">
            <td class="headers_col">
              <img width="16" src="img/dice-06.png">
              <img width="16" src="img/dice-06.png">
              <img width="16" src="img/dice-06.png"><br>
              <img width="16" src="img/dice-03.png">
              <img width="16" src="img/dice-03.png">
            </td>
          </tr>
          <tr class="score_row plays" data-play="_four_of_a_kind">
            <td class="headers_col">
              <img width="16" src="img/dice-05.png">
              <img width="16" src="img/dice-05.png">
              <img width="16" src="img/dice-05.png"><br>
              <img width="16" src="img/dice-05.png">
              <img width="16" src="img/dice-02.png">
            </td>
          </tr>
          <tr class="score_row plays" data-play="_yahtzee">
            <td class="headers_col">
              <img width="16" src="img/dice-02.png">
              <img width="16" src="img/dice-02.png">
              <img width="16" src="img/dice-02.png"><br>
              <img width="16" src="img/dice-02.png">
              <img width="16" src="img/dice-02.png">
            </td>
          </tr>

        </tbody>
      </table>
      </div>
    </div>


    <!-- JQUERY -->
    <script type="text/javascript" src="js/jquery-2.1.0.min.js"></script>
    <!-- BOOTSTRAP -->
    <script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>

    <!-- AL SEIS -->
    <script type="text/javascript" src="js/scoresheet.js"></script>
    <script type="text/javascript" src="js/game.js"></script>
    <script type="text/javascript" src="js/ui.js"></script>

    <!-- LOCAL JAVASCRIPT -->
    <script type="text/javascript">
      $(document).ready(function() {
        // initialization

        alseis.current_game = new alseis.Game({
          nplayers: 3,
          nsheets: 3
        });

        $(alseis.current_game).on('score_changed', function(e, scoresheet, player, game) {
          // update UI with scores
          game.UpdateWinnerStatus();
        });

        alseis.current_game.players[0].name = 'Victor';
        alseis.current_game.players[1].name = 'Carlino';
        alseis.current_game.players[2].name = 'Pablo';

        for (var i = 0; i < alseis.current_game.config.nplayers; i++) {
          alseis.add_scoresheet_column(alseis.current_game, i, $('#scoresheets_table'));
        }

        for (var i in alseis.current_game.players) 
        {
          alseis.current_game.players[i].UpdateTotals();
        }

        function numbers_options(n)
        {
          var ret = '<div class="btn-group">';
          for (var i=0; i<=5; i++)
          {
            ret += '<button type="button" class="btn btn-' + 
                    alseis.color_signals[i] + 
                    ' btnsetplay" data-value="' + i + 
                    '">' + i*n + '</button>';
          }
          ret += '</div>';
          return ret;
        }

        var play_title =
        {
            _straight: 'Escalera',
            _fullhouse: 'Full House',
            _four_of_a_kind: 'PÃ³quer',
            _yahtzee: 'G-TALI'
        };

        function figure_options(play) {
          var ret = '<div class="btn-group">';

          // huevo
          ret += '<button type="button" class="btn btnsetplay btn-danger" data-value="0" data-bonus="false">';
          ret += '<span class="glyphicon glyphicon-remove-sign"></span>';
          ret += '</button>';

          // normal
          ret += '<button type="button" class="btn btnsetplay btn-warning" data-value="1" data-bonus="false">';
          ret += '<span class="glyphicon glyphicon-ok-sign"></span>';
          ret += '</button>';

          // servido
          ret += '<button type="button" class="btn btnsetplay btn-success" data-value="1" data-bonus="true">';
          ret += '<span class="glyphicon glyphicon-plus-sign"></span>';
          ret += '</button>';

          ret += '</div>';
          return ret;
        }

        $.each(['_straight', '_fullhouse', '_four_of_a_kind', '_yahtzee'],
          function( idx, val ) {
            $('._notecell' + val).click(function(e) {
              var $lep = $(this).popover({
                title: play_title[val],
                html: true,
                content: figure_options(val),
                placement: 'bottom',
                container: 'body',
                trigger: 'click' 
              }).on('shown.bs.popover', function(e) {
                $popover = $(this);
                $('.btnsetplay').on('click', function(e) {
                  $cell = $popover.data('orig');
                  console.log($(this));
                  alseis.current_game.Note(
                    $cell.data('player'),
                    $cell.data('scoresheet'),
                    $cell.data('play'),
                    $(this).data('value'),
                    $(this).data('bonus')
                  );
                  $popover.popover('hide');
                });

              }).on('hidden.bs.popover', function(e) {
                $(this).popover('destroy');
              }).data('orig', $(this)).popover('show');
            });
          }
        );

        for (var i = 4; i <= 6; i++) {
          $('._notecell_' + i).click(function(e) {
            var $lep = $(this).popover({
              title: alseis.dice_image_tag(32, $(this).data('value')),
              html: true,
              content: numbers_options($(this).data('value')),
              placement: 'bottom',
              container: 'body',
              trigger: 'click' 
            }).on('shown.bs.popover', function(e) {
              $popover = $(this);
              $('.btnsetplay').on('click', function(e) {
                $cell = $popover.data('orig');
                console.log($(this));
                alseis.current_game.Note(
                  $cell.data('player'),
                  $cell.data('scoresheet'),
                  $cell.data('play'),
                  $(this).data('value'),
                  false
                );
                $popover.popover('hide');
              });
            }).on('hidden.bs.popover', function(e) {
              $(this).popover('destroy');
            }).data('orig', $(this)).popover('show');
          });
        }
      });
    </script>
  </body>
</html>
